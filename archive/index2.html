<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yoste — Journal</title>
  <style>
    :root { color-scheme: light dark; }

    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:#0b0c10;
      color:#e8e8e8;
    }

    /* Sticky header */
    .banner{
      position:sticky; top:0; z-index:1000;
      background:rgba(10,12,16,.95);
      backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .banner-inner{
      max-width:1100px; margin:0 auto;
      padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .title{
      margin:0;
      font-size:18px;
      letter-spacing:2px;
      text-transform:uppercase;
    }
    .actions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    button, input[type="date"]{
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.10);
      color:inherit;
      padding:10px 12px;
      cursor:pointer;
      font-size:13px;
    }
    button:hover{ background:rgba(255,255,255,.14); }
    input[type="date"]{
      padding:9px 10px;
      cursor:text;
      background:rgba(255,255,255,.06);
    }
    .hint{ font-size:12px; opacity:.75; }

    /* Layout */
    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:20px 16px 60px;
    }

    /* Timeline */
    .timeline{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    /* Card */
    .card{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      border-radius:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
      overflow:hidden;
    }

    .card-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:14px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
      cursor:pointer;
      user-select:none;
    }
    .card-header:hover{ background:rgba(255,255,255,.04); }

    .date{
      font-weight:600;
      letter-spacing:.2px;
    }
    .meta{
      display:flex;
      gap:10px;
      align-items:center;
      opacity:.8;
      font-size:12px;
    }
    .pill{
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.18);
      opacity:.9;
    }

    .card-body{
      display:none;
      padding:16px;
      gap:14px;
    }
    .card.open .card-body{ display:grid; }

    .section-title{
      margin:0 0 8px 0;
      font-size:13px;
      opacity:.85;
      letter-spacing:.2px;
      text-transform:uppercase;
    }

    /* Quote */
    .quote{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.20);
      border-radius:14px;
      padding:12px 12px;
    }
    .quote-edit{
      min-height:44px;
      font-size:16px;
      font-style:italic;
      line-height:1.35;
      outline:none;
      white-space:pre-wrap;
    }
    .placeholder:empty:before{
      content: attr(data-placeholder);
      opacity:.45;
    }

    /* Meals table */
    .meals{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.20);
      border-radius:14px;
      padding:12px 12px;
    }
    table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
      overflow:hidden;
      border-radius:12px;
    }
    th, td{
      border:1px solid rgba(255,255,255,.14);
      padding:10px 10px;
      text-align:left;
      vertical-align:top;
      font-size:13px;
    }
    th{
      background:rgba(255,255,255,.06);
      opacity:.9;
      width:33.33%;
    }
    td{
      background:rgba(0,0,0,.12);
      min-height:44px;
    }
    .cell-edit{
      min-height:38px;
      outline:none;
      white-space:pre-wrap;
    }

    /* Editor */
    .entry{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.20);
      border-radius:14px;
      overflow:hidden;
    }
    .ribbon{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.15);
      flex-wrap:wrap;
    }
    .btn-group{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .tool{
      padding:8px 10px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.08);
      font-size:12px;
      cursor:pointer;
    }
    .tool:hover{ background:rgba(255,255,255,.12); }
    .tool.active{ background:rgba(99,102,241,.20); border-color:rgba(99,102,241,.35); }

    .editor-area{
      padding:12px;
    }
    .editor{
      min-height:160px;
      outline:none;
      line-height:1.45;
      font-size:14px;
      white-space:pre-wrap;
    }

    /* Column modes */
    .cols-1 .editor{ column-count:1; column-gap:18px; }
    .cols-2 .editor{ column-count:2; column-gap:18px; }
    .cols-3 .editor{ column-count:3; column-gap:18px; }

    /* Responsive: collapse columns on small screens */
    @media (max-width: 820px){
      .cols-2 .editor, .cols-3 .editor{ column-count:1; }
    }
  </style>
</head>

<body>
  <header class="banner">
    <div class="banner-inner">
      <h1 class="title">Yoste — Journal</h1>
      <div class="actions">
        <input id="newDate" type="date" />
        <button id="addCardBtn">Add entry</button>
        <span class="hint">Newest at top • open one card collapses others</span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="timeline" class="timeline" aria-label="Journal timeline"></div>
  </main>

  <script>
    // ---------- Utilities ----------
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));

    function isoToday(){
      const d = new Date();
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      return `${d.getFullYear()}-${mm}-${dd}`;
    }

    function prettyDate(iso){
      // iso: YYYY-MM-DD
      const [y,m,d] = iso.split("-").map(Number);
      const dt = new Date(y, m-1, d);
      return dt.toLocaleDateString(undefined, { weekday:"short", year:"numeric", month:"short", day:"numeric" });
    }

    function collapseAllExcept(card){
      $$(".card.open").forEach(c => { if(c !== card) c.classList.remove("open"); });
    }

    function getCardISO(card){ return card.getAttribute("data-date"); }

    function sortCardsDesc(){
      const tl = $("#timeline");
      const cards = $$(".card", tl);
      cards.sort((a,b) => getCardISO(b).localeCompare(getCardISO(a)));
      cards.forEach(c => tl.appendChild(c));
    }

    // ---------- Card Creation ----------
    function createCard(isoDate){
      const card = document.createElement("div");
      card.className = "card open cols-1";
      card.setAttribute("data-date", isoDate);

      card.innerHTML = `
        <div class="card-header" role="button" aria-label="Toggle card">
          <div class="date">${prettyDate(isoDate)}</div>
          <div class="meta">
            <span class="pill">Quote</span>
            <span class="pill">Meals</span>
            <span class="pill">Entry</span>
          </div>
        </div>

        <div class="card-body">
          <!-- Quote -->
          <div class="quote">
            <div class="section-title">Quote</div>
            <div class="quote-edit placeholder" contenteditable="true" data-placeholder="Write a quote or a line that matters today…"></div>
          </div>

          <!-- Meals -->
          <div class="meals">
            <div class="section-title">Meals</div>
            <table>
              <thead>
                <tr>
                  <th>B</th>
                  <th>L</th>
                  <th>D</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><div class="cell-edit placeholder" contenteditable="true" data-placeholder="Breakfast…"></div></td>
                  <td><div class="cell-edit placeholder" contenteditable="true" data-placeholder="Lunch…"></div></td>
                  <td><div class="cell-edit placeholder" contenteditable="true" data-placeholder="Dinner…"></div></td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Entry -->
          <div class="entry">
            <div class="ribbon">
              <div class="btn-group">
                <button class="tool" data-cmd="bold" type="button"><b>B</b></button>
                <button class="tool" data-cmd="italic" type="button"><i>I</i></button>
                <button class="tool" data-cmd="underline" type="button"><u>U</u></button>
                <button class="tool" data-cmd="strikeThrough" type="button"><s>S</s></button>
              </div>

              <div class="btn-group" aria-label="Columns">
                <span class="hint" style="margin-right:6px;">Columns:</span>
                <button class="tool" data-cols="1" type="button">1</button>
                <button class="tool" data-cols="2" type="button">2</button>
                <button class="tool" data-cols="3" type="button">3</button>
              </div>
            </div>

            <div class="editor-area">
              <div class="editor placeholder" contenteditable="true"
                   data-placeholder="Free-write here… (bold/italic/underline/strike supported)"></div>
            </div>
          </div>
        </div>
      `;

      // Accordion toggle
      const header = $(".card-header", card);
      header.addEventListener("click", () => {
        const willOpen = !card.classList.contains("open");
        if (willOpen) collapseAllExcept(card);
        card.classList.toggle("open");
      });

      // Formatting tools (uses execCommand; still works in major browsers)
      const editor = $(".editor", card);

      $$(".tool[data-cmd]", card).forEach(btn => {
        btn.addEventListener("click", () => {
          editor.focus();
          document.execCommand(btn.dataset.cmd, false, null);
        });
      });

      // Column splitter
      $$(".tool[data-cols]", card).forEach(btn => {
        btn.addEventListener("click", () => {
          const cols = btn.dataset.cols;
          card.classList.remove("cols-1","cols-2","cols-3");
          card.classList.add(`cols-${cols}`);

          // UI active state
          $$(".tool[data-cols]", card).forEach(b => b.classList.toggle("active", b === btn));
        });
      });

      // Default active column button = 1
      const oneBtn = $(`.tool[data-cols="1"]`, card);
      if (oneBtn) oneBtn.classList.add("active");

      // Prevent rich text paste from bringing in weird styles (optional)
      editor.addEventListener("paste", (e) => {
        e.preventDefault();
        const text = (e.clipboardData || window.clipboardData).getData("text/plain");
        document.execCommand("insertText", false, text);
      });

      // Open card collapses others
      collapseAllExcept(card);

      return card;
    }

    // ---------- One card per date ----------
    function ensureCardForDate(isoDate){
      const existing = $(`.card[data-date="${isoDate}"]`);
      if (existing) {
        existing.classList.add("open");
        collapseAllExcept(existing);
        existing.scrollIntoView({behavior:"smooth", block:"start"});
        return existing;
      }
      const card = createCard(isoDate);
      $("#timeline").appendChild(card);
      sortCardsDesc();
      card.scrollIntoView({behavior:"smooth", block:"start"});
      return card;
    }

    // ---------- Boot ----------
    const newDateEl = $("#newDate");
    newDateEl.value = isoToday();

    $("#addCardBtn").addEventListener("click", () => {
      const iso = newDateEl.value || isoToday();
      ensureCardForDate(iso);
    });

    // Start with today's card
    ensureCardForDate(isoToday());

    // Optional demo: a few previous days so you can see scrolling behavior
    // Comment out if you don't want it.
    (function seedPastDays(n=3){
      const d = new Date();
      for (let i=1;i<=n;i++){
        const dd = new Date(d);
        dd.setDate(d.getDate() - i);
        const mm = String(dd.getMonth()+1).padStart(2,"0");
        const day = String(dd.getDate()).padStart(2,"0");
        const iso = `${dd.getFullYear()}-${mm}-${day}`;
        ensureCardForDate(iso);
      }
      // keep today's open
      ensureCardForDate(isoToday());
    })();
  </script>
</body>
</html>
